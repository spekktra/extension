{"version":3,"sources":["app.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ComponentManager","permissions","onReady","_this","sentMessages","messageQueue","initialPermissions","loggingEnabled","acceptsThemes","onReadyCallback","coallesedSaving","coallesedSavingDelay","messageHandler","event","mobileSource","console","log","data","origin","JSON","parse","handleMessage","document","addEventListener","window","value","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","callback","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","return","environment","uuid","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","item","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this2","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","saveItems","_this3","updated_at","Date","saveBlock","pendingSave","clearTimeout","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","urls","deactivateAllCustomThemes","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","url","link","createElement","href","rel","media","className","getElementsByTagName","appendChild","elements","getElementsByClassName","forEach","call","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","getTime","performance","now","Math","random","floor","module","exports","angular","HomeCtrl","$rootScope","$scope","$timeout","tags","delimitter","name","componentManager","formData","defaultHeight","dummyTag","dummy","tagsInputChange","$event","input","hasExactMatch","tagInput","split","slice","results","tag","title","comps","comp","toLowerCase","startsWith","sort","a","b","rawTitle","showAutocomplete","highlightTag","resetContext","highlightedTag","show","documentElement","scrollHeight","selectTag","createTag","index","tagName","join","_tag","candidate","removeActiveTag","newTags","allTags","existing","tagCandidate","deleted","indexOf","splice","refreshNoteReferences","note","noteHasTag","references","find","ref","tagHasNote","activeTags","highlightNextResult","highlighResultAtIndex","highlightPreviousResult","onEnter","onkeydown","handleArrowKey","e","keyCode","$$ngIsClass","controller"],"mappings":"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","file":"app.js","sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ComponentManager = function () {\n  function ComponentManager(permissions, onReady) {\n    var _this = this;\n\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.initialPermissions = permissions;\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.onReadyCallback = onReady;\n\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n\n    var messageHandler = function messageHandler(event, mobileSource) {\n      if (_this.loggingEnabled) {\n        console.log(\"Components API Message received:\", event.data, \"mobile?\", mobileSource);\n      }\n\n      // The first message will be the most reliable one, so we won't change it after any subsequent events,\n      // in case you receive an event from another window.\n      if (!_this.origin) {\n        _this.origin = event.origin;\n      }\n      _this.mobileSource = mobileSource;\n      // If from mobile app, JSON needs to be used.\n      var data = mobileSource ? JSON.parse(event.data) : event.data;\n      _this.handleMessage(data);\n    };\n\n    // Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n    // for postMessage API to work properly.\n\n    document.addEventListener(\"message\", function (event) {\n      messageHandler(event, true);\n    }, false);\n\n    window.addEventListener(\"message\", function (event) {\n      messageHandler(event, false);\n    }, false);\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n      this.environment = data.environment;\n      this.uuid = data.uuid;\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", { componentData: this.componentData }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage);\n\n      // Mobile (React Native) requires a string for the postMessage API.\n      if (this.mobileSource) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", { type: type, width: width, height: height }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", { permissions: permissions }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n      this.postMessage(\"stream-items\", { content_types: contentTypes }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          When an item is saved via saveItem, its updated_at value is set client side to the current date.\n          If we make a change locally, then for whatever reason receive an item via streamItems/streamContextItem,\n          we want to ignore that change if it was made prior to the latest change we've made.\n           Update 1/22/18: However, if a user is restoring a note from version history, this change\n          will not pass through this filter and will thus be ignored. Because the client now handles\n          this case with isMetadataUpdate, we no longer need the below.\n        */\n        // if(this.streamedContextItem && this.streamedContextItem.uuid == item.uuid\n        //   && this.streamedContextItem.updated_at > item.updated_at) {\n        //   return;\n        // }\n        // this.streamedContextItem = item;\n        callback(item);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", { item: this.jsonObjectForItem(item) }, function (data) {\n        var item = data.item;\n\n        // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this2 = this;\n\n      var mapped = items.map(function (item) {\n        return _this2.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", { items: mapped }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", { item: this.jsonObjectForItem(item) });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", { content_type: \"Tag\" });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item) {\n      this.deleteItems([item]);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n      this.postMessage(\"delete-items\", params);\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      this.saveItems([item], callback);\n    }\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this3 = this;\n\n      items = items.map(function (item) {\n        item.updated_at = new Date();\n        return this.jsonObjectForItem(item);\n      }.bind(this));\n\n      var saveBlock = function saveBlock() {\n        _this3.postMessage(\"save-items\", { items: items }, function (data) {\n          callback && callback();\n        });\n      };\n\n      /*\n        Coallesed saving prevents saves from being made after every keystroke, and instead\n        waits coallesedSavingDelay before performing action. For example, if a user types a keystroke, and the clienet calls saveItem,\n        a 250ms delay will begin. If they type another keystroke within 250ms, the previously pending\n        save will be cancelled, and another 250ms delay occurs. If ater 250ms the pending delay is not cleared by a future call,\n        the save will finally trigger.\n         Note: it's important to modify saving items updated_at immediately and not after delay. If you modify after delay,\n        a delayed sync could just be wrapping up, and will send back old data and replace what the user has typed.\n      */\n      if (this.coallesedSaving == true) {\n        if (this.pendingSave) {\n          clearTimeout(this.pendingSave);\n        }\n\n        this.pendingSave = setTimeout(function () {\n          saveBlock();\n        }, this.coallesedSavingDelay);\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(urls) {\n      this.deactivateAllCustomThemes();\n\n      if (this.loggingEnabled) {\n        console.log(\"Activating themes:\", urls);\n      }\n\n      if (!urls) {\n        return;\n      }\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = urls[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var url = _step2.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"deactivateAllCustomThemes\",\n    value: function deactivateAllCustomThemes() {\n      var elements = document.getElementsByClassName(\"custom-theme\");\n\n      [].forEach.call(elements, function (element) {\n        if (element) {\n          element.disabled = true;\n          element.parentNode.removeChild(element);\n        }\n      });\n    }\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n\n  constructor($rootScope, $scope, $timeout) {\n\n    $scope.tags = [];\n\n    var delimitter = \".\";\n\n    var permissions = [\n      {\n        name: \"stream-items\",\n        content_types: [\"Tag\"]\n      },\n      {\n        name: \"stream-context-item\"\n      }\n    ]\n\n    let componentManager = new window.ComponentManager(permissions, function(){\n      // on ready\n    });\n\n    $scope.formData = {};\n    let defaultHeight = 28;\n\n    $scope.dummyTag = {dummy: true, content: {}};\n\n    $scope.tagsInputChange = function($event) {\n      var input = $scope.formData.input || \"\";\n\n      var hasExactMatch = false;\n      var tagInput = input.split(\"#\").slice(-1)[0];\n      if(tagInput) {\n        $scope.results = $scope.tags.filter((tag) => {\n          if(!hasExactMatch) {\n            hasExactMatch = tag.content.title == tagInput;\n          }\n          var comps = tag.content.title.split(delimitter);\n          for(var comp of comps) {\n            if(comp.length && comp.toLowerCase().startsWith(tagInput.toLowerCase())) {\n              return true;\n            }\n          }\n          return tag.content.title.toLowerCase().startsWith(tagInput.toLowerCase());\n        }).sort(function(a, b){\n          return a.content.title > b.content.title;\n        })\n      } else {\n        $scope.results = [];\n      }\n\n      if(!hasExactMatch && tagInput.length> 0) {\n        $scope.dummyTag.content.rawTitle = tagInput;\n        $scope.dummyTag.content.title = `Create new tag '${tagInput}'`;\n        $scope.results.push($scope.dummyTag);\n      }\n\n      $scope.showAutocomplete($scope.results.length > 0);\n      $scope.highlightTag($scope.results[0]);\n    }\n\n    $scope.resetContext = function() {\n      $scope.formData.input = \"\";\n      $scope.highlightedTag = null;\n      $scope.results = [];\n      $scope.showAutocomplete(false);\n    }\n\n    $scope.showAutocomplete = function(show) {\n      $scope.formData.showAutocomplete = show;\n\n      $timeout(function(){\n        if(show) {\n          componentManager.setSize(\"content\", \"100%\", document.documentElement.scrollHeight);\n        } else {\n          componentManager.setSize(\"content\", \"100%\", defaultHeight);\n        }\n      })\n    }\n\n    $scope.selectTag = function(tag) {\n      if(tag.dummy) {\n        $scope.createTag(tag.content.rawTitle);\n        return;\n      }\n\n      var comps = tag.content.title.split(delimitter);\n      for(var index = 1; index < comps.length + 1; index++) {\n        var tagName = comps.slice(0, index).join(delimitter);\n        var _tag = $scope.tags.filter(function(candidate){\n          return candidate.content.title === tagName;\n        })[0]\n\n        componentManager.associateItem(_tag);\n      }\n\n      $scope.resetContext();\n    }\n\n    $scope.removeActiveTag = function(tag) {\n      componentManager.deassociateItem(tag);\n    }\n\n    componentManager.streamItems(['Tag'], function(newTags) {\n      $timeout(function(){\n        var allTags = $scope.tags || [];\n\n        for(var tag of newTags) {\n          var existing = allTags.filter(function(tagCandidate){\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else {\n            allTags.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = allTags.indexOf(existing || tag);\n            allTags.splice(index, 1);\n          }\n        }\n\n        $scope.tags = allTags;\n        $scope.refreshNoteReferences();\n      })\n\n    }.bind(this));\n\n    componentManager.streamContextItem((item) => {\n      $scope.note = item;\n      $timeout(() => {\n        $scope.refreshNoteReferences();\n      })\n    })\n\n    $scope.refreshNoteReferences = function() {\n      $scope.resetContext();\n\n      if(!$scope.note) {\n        return;\n      }\n\n      var tags = $scope.tags.filter(function(tag){\n        var noteHasTag = $scope.note.content.references.find((ref) => {\n          return ref.uuid === tag.uuid\n        });\n\n        var tagHasNote = tag.content.references.find((ref) => {\n          return ref.uuid == $scope.note.uuid;\n        })\n\n        return noteHasTag || tagHasNote;\n      })\n\n      $scope.activeTags = tags.sort(function(a, b){\n        return a.content.title > b.content.title;\n      })\n    }\n\n    $scope.highlightTag = function(tag) {\n      $scope.highlightedTag = tag;\n    }\n\n    $scope.highlightNextResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      $scope.highlighResultAtIndex(index + 1);\n    }\n\n    $scope.highlightPreviousResult = function() {\n      if(!$scope.results) {\n        return;\n      }\n      var index = $scope.results.indexOf($scope.highlightedTag);\n      index--;\n      if(index < 0) {\n        index = $scope.results.length - 1;\n      }\n      $scope.highlighResultAtIndex(index);\n    }\n\n    $scope.highlighResultAtIndex = function(index) {\n      $scope.highlightTag($scope.results[index % $scope.results.length]);\n    }\n\n    $scope.onEnter = function() {\n      if($scope.highlightedTag) {\n        $scope.selectTag($scope.highlightedTag);\n      }\n    }\n\n    $scope.createTag = function(title) {\n      componentManager.createItem({content_type: \"Tag\", content: {title: title}});\n    }\n\n    componentManager.setSize(\"container\", \"100%\", defaultHeight);\n\n    document.onkeydown = handleArrowKey;\n\n    function handleArrowKey(e) {\n        e = e || window.event;\n        if (e.keyCode == '38') {\n          // up arrow\n          $timeout(function(){\n            $scope.highlightPreviousResult();\n          })\n        } else if (e.keyCode == '40') {\n          // down arrow\n          $timeout(function(){\n            $scope.highlightNextResult();\n          });\n        }\n    }\n\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n"]}